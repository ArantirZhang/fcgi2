#
#  Makefile for FastCGI development kit
#
#  Open Market, Inc.
#
#  $Id: Makefile.in,v 1.2 2001/08/27 19:52:49 robs Exp $
#
SHELL = @SHELL@
O =     @O@
L =     @L@

#
exec_prefix   = @exec_prefix@
prefix        = @prefix@
common_prefix = @common_prefix@
CVS_TAG =       @CVS_TAG@
EXPORT_DIR = $(prefix)/build
PROTO_DIR = ../proto
BIN_DIR       = $(exec_prefix)/bin
LIB_DIR       = $(prefix)/lib
LINC_DIR      = $(prefix)/include
COMMON_DIR    = $(common_prefix)
INC_DIR       = $(common_prefix)/include
DOC_DIR       = $(common_prefix)/doc
MAN_DIR       = $(common_prefix)/man
MAN1_DIR      = $(MAN_DIR)/man1
MAN3_DIR      = $(MAN_DIR)/man3
RANLIB        = @RANLIB@

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@

TARGET_DIRS = $(BIN_DIR) $(LIB_DIR) $(COMMON_DIR) $(INC_DIR) $(MAN_DIR) \
              $(MAN1_DIR) $(MAN3_DIR) $(LINC_DIR) $(EXPORT_DIR)

LINKS = examples/perl examples/tclsh

all:
	(cd libfcgi; make all)
	(cd cgi-fcgi; make all)
	(cd examples; make all)

export:
	@ for i in $(TARGET_DIRS); \
	  do \
	  if test ! -d $$i; then \
	    echo "Creating $$i";\
	    mkdir -p $$i;\
	  fi;\
	  done;

	$(INSTALL_DATA)    include/fastcgi.h $(INC_DIR)
	$(INSTALL_DATA)    include/fcgi_stdio.h $(INC_DIR)
	$(INSTALL_DATA)    include/fcgiapp.h $(INC_DIR)
	$(INSTALL_DATA)    include/fcgimisc.h $(INC_DIR)
	$(INSTALL_DATA)    include/fcgi_config.h $(LINC_DIR)
	$(INSTALL_DATA)    libfcgi/libfcgi.${L} $(LIB_DIR)
	$(RANLIB)          $(LIB_DIR)/libfcgi.${L}
	$(INSTALL_PROGRAM) cgi-fcgi/cgi-fcgi $(BIN_DIR)
	$(INSTALL_DATA)    doc/cgi-fcgi.1 $(MAN1_DIR)
	$(INSTALL_DATA)    doc/FCGI_Accept.3 $(MAN3_DIR)
	$(INSTALL_DATA)    doc/FCGI_Finish.3 $(MAN3_DIR)
	$(INSTALL_DATA)    doc/FCGI_SetExitStatus.3 $(MAN3_DIR)
	$(INSTALL_DATA)    doc/FCGI_StartFilterData.3 $(MAN3_DIR)
	rm -rf $(PROTO_DIR)
	for i in $(LINKS); do  if  test ! -r $$i; then rm -f $$i; fi; done; 
	cp -R . $(PROTO_DIR) 
	(cd $(PROTO_DIR); make clean)
	find $(PROTO_DIR) -name CVS -exec rm -rf {} \;
	rm -rf $(EXPORT_DIR)
	cp -R $(PROTO_DIR) $(EXPORT_DIR)
	rm -rf $(PROTO_DIR)

reconfig: clean
	uname -rs >config.uname
	./configure

clean:
	rm -f *.${L} *.${O} core.* errs *~ \#* TAGS *.E a.out
	rm -f *.${L} *.${O} core.* errs *~ \#* TAGS *.E a.out
	rm -f config.cache config.log config.status config.uname
	(cd libfcgi; make clean)
	(cd cgi-fcgi; make clean)
	(cd examples; make clean)

# ----------------------------------------------------------------------------
