#
#  Makefile for FastCGI examples directory
#
#  Open Market, Inc.
#
#  $Id: Makefile.in,v 1.6 1999/07/28 02:25:32 roberts Exp $
#

SHELL = @SHELL@
O =     @O@
L =     @L@
CC	= @CC@

INCLUDEDIR  = ../include
CFLAGS	= @CCDEFS@ @PROFILE@ -I$(INCLUDEDIR)
LIBS	= @LIBS@
RANLIB	= @RANLIB@

INCLUDES    = $(INCLUDEDIR)/fastcgi.h $(INCLUDEDIR)/fcgiapp.h \
	      $(INCLUDEDIR)/fcgimisc.h $(INCLUDEDIR)/fcgiappmisc.h \
              $(INCLUDEDIR)/fcgi_stdio.h
LIBDIR      = ../libfcgi
LIBFCGI	    = $(LIBDIR)/libfcgi.${L}
TARGETS	    = tiny-fcgi tiny-fcgi2 tiny-authorizer \
	      echo echo2 SampleStore/sample-store sockets echo.fcg \
              SampleStore/SampleStore.state.0 SampleStore/SampleStore.state.1 log-dump threaded.fcg

all: $(TARGETS)

threaded.fcg: threaded.c $(INCLUDES)
	$(CC) $(CFLAGS) -D_REENTRANT threaded.c -o threaded.fcg $(LIBFCGI) $(LIBS) -lpthread

tiny-fcgi: tiny-fcgi.${O} $(LIBFCGI)
	$(CC) $(CFLAGS) tiny-fcgi.${O} -o tiny-fcgi $(LIBFCGI) $(LIBS)

tiny-fcgi2: tiny-fcgi2.${O} $(LIBFCGI)
	$(CC) $(CFLAGS) tiny-fcgi2.${O} -o tiny-fcgi2 $(LIBFCGI) $(LIBS)

tiny-authorizer: tiny-authorizer.${O} $(LIBFCGI)
	$(CC) $(CFLAGS) tiny-authorizer.${O} -o tiny-authorizer $(LIBFCGI) $(LIBS)

echo: echo.${O} $(LIBFCGI)
	$(CC) $(CFLAGS) echo.${O} -o echo $(LIBFCGI) $(LIBS)

echo2: echo2.${O} $(LIBFCGI)
	$(CC) $(CFLAGS) echo2.${O} -o echo2 $(LIBFCGI) $(LIBS)

SampleStore/sample-store: SampleStore/sample-store.${O} SampleStore/tclHash.${O} $(LIBFCGI)
	$(CC) $(CFLAGS) -ISampleStore SampleStore/sample-store.${O} SampleStore/tclHash.${O} -o SampleStore/sample-store $(LIBFCGI) $(LIBS)

log-dump: log-dump.${O} $(LIBFCGI)
	$(CC) $(CFLAGS) log-dump.${O} -o log-dump $(LIBFCGI) $(LIBS)

sockets:
	mkdir sockets

echo.fcg:
	rm -f echo.fcg
	ln -s echo echo.fcg

SampleStore/SampleStore.state.0:
	mkdir SampleStore/SampleStore.state.0

SampleStore/SampleStore.state.1:
	mkdir SampleStore/SampleStore.state.1

clean:
	rm -rf sockets SampleStore/SampleStore.state.?
	rm -f *.${L} *.${O} core.* errs *~ \#* TAGS *.E a.out $(TARGETS)

# ----------------------------------------------------------------------------

tiny-fcgi.${O}: tiny-fcgi.c $(INCLUDES)

tiny-fcgi2.${O}: tiny-fcgi2.c $(INCLUDES)

tiny-authorizer.${O}: tiny-authorizer.c $(INCLUDES)

echo.${O}: echo.c $(INCLUDES)

echo2.${O}: echo2.c $(INCLUDES)

SampleStore/sample-store.${O}: SampleStore/sample-store.c $(INCLUDES)
	$(CC) $(CFLAGS) -ISampleStore -c SampleStore/sample-store.c -o SampleStore/sample-store.${O}

SampleStore/tclHash.${O}: SampleStore/tclHash.c
	$(CC) $(CFLAGS) -ISampleStore -c SampleStore/tclHash.c -o SampleStore/tclHash.${O}

log-dump.${O}: log-dump.c $(INCLUDES)
